{% extends 'base.html.twig' %}

{% block title %}Planning de repas{% endblock %}

{% block body %}
<div 
     data-turbo="false"
     data-controller="agenda"
     data-agenda-week-url-value="{{ path('meal_plan_week') }}"
     data-agenda-initial-start-value="{{ weekStart|date('Y-m-d') }}"
>
  <noscript>
    <div class="alert alert-warning">
      Le planning en mode agenda nécessite JavaScript.
    </div>
  </noscript>

  {# Flash messages #}
  {% for label, messages in app.flashes %}
    {% for message in messages %}
      <div class="alert alert-{{ label == 'error' ? 'danger' : label }} mb-3">
        {{ message }}
      </div>
    {% endfor %}
  {% endfor %}

  <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h3 mb-1">Planning de repas</h1>
    </div>

    <div class="d-flex gap-2 flex-wrap">
      <a class="btn btn-outline-primary btn-sm" href="{{ path('app_recipe_index') }}">
        Voir mes recettes
      </a>
    </div>
  </div>

  {# Zone scrollable (le scroll ne bouge plus la page entière => menu accessible) #}
  <div class="border rounded"
       style="height: calc(100vh - 220px); overflow: auto;"
       data-agenda-target="scroller">

    {# Debug / loading state #}
    <div data-agenda-target="error" class="alert alert-danger d-none m-3"></div>

    <div data-agenda-target="loading" class="text-center text-body-secondary small my-3 d-none">
      Chargement de la semaine…
    </div>

    {# Sentinel haut: scroll infini vers le passé #}
    <div data-agenda-target="topSentinel"
         class="py-2 text-center text-body-secondary small">
      ⬆️ Charger les semaines précédentes…
    </div>

    {# Contenu agenda: semaines injectées ici #}
    <div data-agenda-target="list" class="d-flex flex-column gap-3 pb-3">
      {# La semaine courante sera chargée en AJAX dès connect() #}
    </div>

    {# Sentinel bas: scroll infini vers le futur #}
    <div data-agenda-target="bottomSentinel"
         class="py-2 text-center text-body-secondary small">
      ⬇️ Charger les semaines suivantes…
    </div>

  </div>
</div>
{% endblock %}
