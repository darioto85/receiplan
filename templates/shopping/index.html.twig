{% extends 'base.html.twig' %}

{% block title %}Liste de courses{% endblock %}

{% block body %}
  <div
    data-controller="shopping"
    data-shopping-toggle-url-value="{{ path('shopping_toggle', { id: 0 }) }}"
    data-shopping-validate-url-value="{{ path('shopping_validate_cart') }}"
    data-shopping-update-quantity-url-value="{{ path('shopping_update_quantity', { id: 0 }) }}"
    data-shopping-upsert-url-value="{{ path('shopping_upsert') }}"
    data-shopping-csrf-token-value="{{ csrf_token('shopping_cart') }}"
  >
    <div class="d-flex justify-content-between align-items-center mb-3 gap-2 flex-wrap">
      <h1 class="mb-0"><img class="rp-title-thumb" src="{{ asset('img/actions/courses.png') }}" alt=""> Courses</h1>

      <div class="d-flex align-items-center gap-2 flex-wrap">
        <button
          class="btn btn-primary d-flex align-items-center gap-2"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#shoppingUpsertForm"
          aria-controls="shoppingUpsertForm"
        >
          <img class="bt-action-thumb" src="{{ asset('img/actions/stock_add.png') }}" alt="">
          <span class="d-none d-sm-inline">Ajouter manuellement</span>
          <span class="d-inline d-sm-none">Ajout</span>
        </button>

        <a
          href="{{ path('shopping_generate') }}"
          class="btn btn-outline-primary d-flex align-items-center gap-2"
          title="Générer ma liste d'ingrédient nécessaire a mes recettes"
        >
          <img class="bt-action-thumb" src="{{ asset('img/actions/generer_courses.png') }}" alt="">
          <span class="d-none d-sm-inline">Générer ma liste</span>
        </a>

        <button
          type="button"
          class="btn btn-primary d-flex align-items-center gap-2"
          data-shopping-target="validateBtn"
          data-action="shopping#validateCart"
          disabled
          title="Valider les produits cochés et les ajouter au stock"
        >
          <img class="bt-action-thumb" src="{{ asset('img/actions/caddie.png') }}" alt="">
          <span class="d-none d-sm-inline">Valider mon caddie</span>
          <span class="d-inline d-sm-none">Valider</span>
        </button>
      </div>
    </div>

    {# ===== Quick Add Bar (comme Stock) ===== #}
    <div id="shoppingUpsertForm" class="collapse mb-4">
      <div class="mb-2" data-shopping-target="formErrors"></div>

      {{ form_start(form, {
        action: path('shopping_upsert'),
        method: 'POST',
        attr: {
          class: 'rp-quickadd',
          'data-action': 'submit->shopping#submitUpsert'
        }
      }) }}

        <div class="rp-quickadd__bar">
          <div class="rp-quickadd__field">
            {{ form_widget(form.ingredient, { attr: { class: 'rp-quickadd__input', placeholder: 'Ajouter rapidement' } }) }}
            {{ form_errors(form.ingredient) }}
          </div>

          <div class="rp-quickadd__mini">
            {{ form_widget(form.quantity, { attr: { class: 'rp-quickadd__miniInput', placeholder: 'Qté…', inputmode: 'decimal' } }) }}
            {{ form_errors(form.quantity) }}
          </div>

          <div class="rp-quickadd__mini">
            <div class="rp-quickadd__miniFake" aria-hidden="true">—</div>
          </div>

          <button type="submit" class="rp-quickadd__btn">
            <span class="rp-quickadd__btnIcon">+</span>
            <span>Ajouter</span>
            <span class="rp-quickadd__btnChevron">›</span>
          </button>
        </div>

      {{ form_end(form) }}
    </div>

    <div data-shopping-target="listing">
      {{ include('shopping/_listing.html.twig', { items: items }) }}
    </div>
  </div>
{% endblock %}
