<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>{% block title %}Receiplan{% endblock %}</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >

    {% block stylesheets %}{% endblock %}

    {% block javascripts %}
      {{ importmap('app') }}
    {% endblock %}
  </head>

  <body>
    <div class="container">
      {% if app.request.query.get('reset') %}
        <div class="alert alert-success mt-2">
          Mot de passe mis à jour. Tu peux te connecter.
        </div>
      {% endif %}

      <div class="row justify-content-center align-items-center min-vh-100">
        <div class="col-12 col-sm-10 col-md-8 col-lg-5 col-xl-4">

          <div class="card shadow-sm">
            <div class="card-body p-4">

              <h1 class="h4 text-center mb-4">Connexion</h1>

              {% if error %}
                <div class="alert alert-danger">
                  {{ error.messageKey|trans(error.messageData, 'security') }}
                </div>
              {% endif %}

              {% if app.user %}
                <div class="alert alert-info">
                  Vous êtes déjà connecté en tant que <strong>{{ app.user.userIdentifier }}</strong>.
                  <a href="{{ path('app_logout') }}" class="alert-link">Se déconnecter</a>
                </div>
              {% endif %}

              {# --- Google OAuth --- #}
              <div class="d-grid gap-2 mb-3">
                <a
                  href="{{ path('connect_google_start') }}"
                  class="btn btn-outline-dark"
                  data-turbo="false"
                >
                  Continuer avec Google
                </a>
              </div>

              <div class="text-center text-body-secondary small mb-3">
                — ou —
              </div>

              <form method="post" novalidate>
                <div class="mb-3">
                  <label for="inputEmail" class="form-label">Email</label>
                  <input
                    type="text"
                    name="email"
                    id="inputEmail"
                    class="form-control"
                    value="{{ last_username }}"
                    required
                    autofocus
                    autocomplete="username"
                  >
                </div>

                <div class="mb-3">
                  <label for="inputPassword" class="form-label">Mot de passe</label>
                  <input
                    type="password"
                    name="password"
                    id="inputPassword"
                    class="form-control"
                    required
                    autocomplete="current-password"
                  >
                </div>

                <input
                  type="hidden"
                  name="_csrf_token"
                  value="{{ csrf_token('authenticate') }}"
                >

                <div class="d-grid">
                  <button class="btn btn-primary" type="submit">
                    Se connecter
                  </button>
                </div>

                <div class="text-center mt-3">
                  <a href="{{ path('forgot_password') }}" class="link-secondary small" data-turbo="false">
                    Mot de passe oublié ?
                  </a>
                </div>
              </form>

            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    ></script>
  </body>
</html>
