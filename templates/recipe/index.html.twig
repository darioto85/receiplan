{% extends 'base.html.twig' %}

{% block title %}Recettes{% endblock %}

{% block body %}
  <div class="d-flex justify-content-between align-items-center mb-3 gap-2 flex-wrap">
    <h1 class="mb-0">
      <img class="rp-title-thumb" src="{{ asset('img/actions/recettes.png') }}" alt="">
      Recettes
    </h1>

    <a href="{{ path('recipe_wizard_new') }}" class="btn btn-primary">
      <img class="bt-action-thumb" src="{{ asset('img/actions/recette_add.png') }}" alt="">
      Nouvelle recette
    </a>
  </div>

  <div class="accordion rp-accordion" id="recipesAccordion">

    {# =========================
       Faisables (ouverts)
       ========================= #}
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingOk">
        <button
          class="accordion-button"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#collapseOk"
          aria-expanded="true"
          aria-controls="collapseOk"
        >
          Faisables
          <span class="badge text-bg-success ms-2">{{ feasible|length }}</span>
        </button>
      </h2>

      <div
        id="collapseOk"
        class="accordion-collapse collapse show"
        aria-labelledby="headingOk"
        data-bs-parent="#recipesAccordion"
      >
        <div class="accordion-body p-2">
          {% if feasible|length == 0 %}
            <div class="card">
              <div class="card-body text-muted">
                Aucune recette faisable avec ton stock actuel.
              </div>
            </div>
          {% else %}
            <div class="rp-recipe-grid">
              {% for view in feasible %}
                {{ include('recipe/_card.html.twig', {
                  view: view,
                  is_feasible: true,
                  show_favorite: true
                }) }}
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    {# =========================
       Stock insuffisant (repli√©)
       ========================= #}
    <div class="accordion-item mt-2">
      <h2 class="accordion-header" id="headingMissing">
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#collapseMissing"
          aria-expanded="false"
          aria-controls="collapseMissing"
        >
          Stock insuffisant
          <span class="badge text-bg-danger ms-2">{{ insufficient|length }}</span>
        </button>
      </h2>

      <div
        id="collapseMissing"
        class="accordion-collapse collapse"
        aria-labelledby="headingMissing"
        data-bs-parent="#recipesAccordion"
      >
        <div class="accordion-body p-2">
          {% if insufficient|length == 0 %}
            <div class="card">
              <div class="card-body text-muted">
                Super : aucune recette en manque.
              </div>
            </div>
          {% else %}
            <div class="rp-recipe-grid">
              {% for view in insufficient %}
                {{ include('recipe/_card.html.twig', {
                  view: view,
                  is_feasible: false,
                  show_favorite: true
                }) }}
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>

  </div>
{% endblock %}
