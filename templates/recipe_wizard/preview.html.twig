{# templates/recipe_wizard/preview.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Aper√ßu recette{% endblock %}

{% block body %}
  <div class="card shadow-sm">
    <div class="card-body">

      <div class="d-flex align-items-center justify-content-between mb-3 gap-2 flex-wrap">
        <h1 class="mb-0">
          <img class="rp-title-thumb" src="{{ asset('img/actions/recipe_preview.png') }}" alt="">
          Aper√ßu
          {% if recipe.draft %}
            <span class="badge text-bg-warning ms-2">Brouillon</span>
          {% else %}
            <span class="badge text-bg-success ms-2">Publi√©</span>
          {% endif %}
        </h1>

        <a href="{{ path('app_recipe_index') }}" class="btn btn-link">‚Üê Retour</a>
      </div>

      <div class="text-muted mb-4">
        √âtape 3/3 ‚Äî V√©rifie la recette avant validation
      </div>

      {# ===== NOM ===== #}
      <div class="mb-4">
        <div class="text-muted small mb-1">Nom</div>
        <div class="h4 mb-0">{{ recipe.name }}</div>
      </div>

      <hr class="my-4">

      {# ===== INGR√âDIENTS ===== #}
      <div class="mb-3 d-flex align-items-center justify-content-between gap-2 flex-wrap">
        <h2 class="h5 mb-0">üßÇ Ingr√©dients</h2>

        <a href="{{ path('recipe_wizard_edit', { id: recipe.id }) }}" class="btn btn-outline-secondary">
          Modifier
        </a>
      </div>

      {% set items = recipe.recipeIngredients %}

      {% if items is empty %}
        <div class="text-muted">Aucun ingr√©dient.</div>
      {% else %}
        <div class="list-group mb-4">
          {% for ri in items %}
            {% set ing = ri.ingredient %}
            {% set unit = (ing and ing.unit) ? ing.unit.value : '' %}
            <div class="list-group-item d-flex align-items-center justify-content-between gap-3">
              <div class="d-flex align-items-center gap-2" style="min-width:0;">
                <img
                  src="{{ ingredient_image(ing) }}"
                  alt="{{ ing.name }}"
                  width="42"
                  height="42"
                  loading="lazy"
                  style="object-fit: contain; border-radius: 8px;"
                >
                <div class="text-truncate">
                  <div class="fw-semibold">{{ ing.name|capitalize }}</div>
                  {% if unit %}
                    <div class="text-muted small">{{ unit }}</div>
                  {% endif %}
                </div>
              </div>

              <div class="fw-bold text-nowrap">
                {{ ri.quantity }}
                {% if unit %} {{ unit }}{% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      {# ===== ACTIONS ===== #}
      <div class="d-flex justify-content-between align-items-center gap-2 flex-wrap">
        <a href="{{ path('recipe_wizard_edit', { id: recipe.id }) }}" class="btn btn-outline-secondary">
          ‚Üê Revenir modifier
        </a>

        {% if recipe.draft %}
          <form method="post" action="{{ path('recipe_wizard_publish', { id: recipe.id }) }}">
            <input type="hidden" name="_token" value="{{ csrf_token('recipe_publish_' ~ recipe.id) }}">
            <button type="submit" class="btn btn-success">
              ‚úÖ Valider et publier
            </button>
          </form>
        {% else %}
          <span class="text-muted">Cette recette est d√©j√† publi√©e.</span>
        {% endif %}
      </div>

    </div>
  </div>
{% endblock %}
